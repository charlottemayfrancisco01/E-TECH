<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MIX & MATCH</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; }
html, body { height:100%; overflow:hidden; background: #f0f2f5; }

@import url('https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&display=swap');
body { font-family:'Baloo 2', cursive; }

.page {
    display:flex;
    justify-content:center;
    align-items:center;
    width:100%;
    height:100vh;
    position:relative;
    overflow:hidden;
}

canvas.bg-canvas {
    position: absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    z-index:0;
    pointer-events: none;
}

#arrowCanvas {
    position: absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    z-index:1;
    pointer-events: none;
}

.center-box {
    position:relative;
    z-index:2;
    text-align:center;
    background:rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(5px);
    padding:60px 50px;
    border-radius:25px;
    width:85%;
    max-width:700px;
    border:4px solid #6a4fb2;
    box-shadow:0 10px 25px rgba(0,0,0,.15);
}

h1,h2{ font-family: 'Baloo 2', cursive; color: #4b308a; font-weight: 700; margin-bottom: 20px;}
p { font-size: 1.2rem; line-height: 1.6; color: #333; }

button {
    margin-top:20px;
    padding:15px 30px;
    font-size:1.3em;
    border:none;
    border-radius:15px;
    cursor:pointer;
    transition:.2s;
    font-family: inherit;
    font-weight: bold;
}
button:hover{ transform:scale(1.05); filter: brightness(1.1); }

#start-btn { background: linear-gradient(45deg, #ff6b6b, #feca57); color:white; }
#play-btn { background: linear-gradient(45deg, #48dbfb, #1dd1a1); color:white; }

.game-container {
    display:flex;
    justify-content:center;
    align-items: center;
    gap: clamp(20px, 5vw, 100px);
    z-index:2;
    width: 90%;
}

.questions-column { display:flex; flex-direction:column; gap: 15px; width: 45%; }
.question {
    background: white; 
    border-radius:12px; 
    cursor:pointer;
    border:3px solid #cdb4db;
    transition: all 0.3s;
    font-size: clamp(0.9em, 1.2vw, 1.1em);
    line-height: 1.3;
    padding: 15px;
    text-align: left;
    position: relative;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.question.selected { border-color: #1e90ff; background:#eef6ff; transform: translateX(10px); }

/* Feedback icons style */
.status-icon {
    font-size: 1.2em;
    margin-left: 10px;
    display: none;
}

.images-column { display:flex; flex-direction:column; gap:15px; width: 180px; }
.image-box {
    background: white;
    border-radius: 12px;
    padding: 10px;
    position: relative;
    border: 3px solid #a2d2ff;
    transition: 0.3s;
}

.image-item { position:relative; cursor:pointer; }
.image-item img { width:100%; display:block; border-radius: 8px; }

.letter-label {
    position:absolute; top:-15px; left:-15px; width:30px; height:30px;
    background:#6a4fb2; color:white; font-weight:bold; border-radius:50%;
    display:flex; justify-content:center; align-items:center; border: 2px solid white;
}

.submit-container {
    position:fixed;
    bottom:20px;
    right:20px;
    z-index:100;
    display:flex;
    flex-direction:column;
    align-items:flex-end;
    gap:10px;
}

.score-box {
    display: none;
    background: white;
    padding: 10px 20px;
    border-radius: 12px;
    font-size: 1.2em;
    font-weight: bold;
    color: #6a4fb2;
    border: 3px solid #6a4fb2;
}

.submit-btn {
    padding:15px 40px;
    font-size:1.2em;
    background:linear-gradient(45deg,#ff9ff3,#f368e0);
    color:white;
    border-radius:15px;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.topLink {
    position: fixed;
    top: 15px;
    left: 15px;
    z-index: 10;
    padding: 10px 16px;
    font-size: 14px;
    border-radius: 14px;
    background: #6a5acd;
    color: white;
    text-decoration: none;
    font-weight: bold;
    box-shadow: 0 6px 15px rgba(0,0,0,0.2);
}

.topLink:nth-child(2) { top: 60px; }
</style>
</head>
<body>

<a href="activities.html" class="topLink">Activities</a>
<a href="lottie.html" class="topLink">Story</a>

<section id="front-page" class="page">
    <canvas id="frontBg" class="bg-canvas"></canvas>
    <div class="center-box">
        <h1>MIX & MATCH</h1>
        <button id="start-btn" onclick="goToPage('instructions-page')">Start Game</button>
    </div>
</section>

<section id="instructions-page" class="page" style="display:none;">
    <canvas id="instrBg" class="bg-canvas"></canvas>
    <div class="center-box">
        <h2>PANUTO</h2>
        <p>Tingnan ang mga larawan ng Word Processing Software. I-click ang tanong at ikonekta ito sa tamang larawan gamit ang iyong mouse o daliri.</p>
        <button id="play-btn" onclick="goToPage('game-page')">Play Now</button>
    </div>
</section>

<section id="game-page" class="page" style="display:none;">
    <canvas id="gameBg" class="bg-canvas"></canvas>
    <canvas id="arrowCanvas"></canvas>
    <div class="game-container">
        <div class="questions-column" id="questions-column"></div>
        <div class="images-column" id="images-column"></div>
    </div>
    <div class="submit-container">
        <div class="score-box" id="scoreBox">Score: 0 / 5</div>
        <button class="submit-btn" id="submit-btn">Check Answers</button>
        <button class="submit-btn" id="nextSet-btn" style="background: #48dbfb;">Next Level</button>
    </div>
</section>

<section id="congrats-page" class="page" style="display:none;">
    <canvas id="winBg" class="bg-canvas"></canvas>
    <div class="center-box">
        <h1>ðŸŽ‰ EXCELLENT! ðŸŽ‰</h1>
        <p>You have mastered the Word Processing Software parts!</p>
        <button onclick="location.reload()" style="background: #1dd1a1; color: white;">Play Again</button>
    </div>
</section>

<script>
/* =========================================
    ðŸ”Š SOUND ENGINE (Web Audio API)
   ========================================= */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(type) {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const now = audioCtx.currentTime;
    if (type === 'pop') {
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.connect(g); g.connect(audioCtx.destination);
        osc.type = 'triangle';
        osc.frequency.setValueAtTime(300, now);
        osc.frequency.exponentialRampToValueAtTime(50, now + 0.1);
        g.gain.setValueAtTime(0.1, now);
        g.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
        osc.start(); osc.stop(now + 0.1);
    } else if (type === 'success') {
        [523.25, 659.25, 783.99, 1046.50].forEach((f, i) => {
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.connect(g); g.connect(audioCtx.destination);
            const start = now + (i * 0.05);
            osc.frequency.setValueAtTime(f, start);
            g.gain.setValueAtTime(0.05, start);
            g.gain.exponentialRampToValueAtTime(0.01, start + 0.2);
            osc.start(start); osc.stop(start + 0.2);
        });
    } else if (type === 'error') {
        [220, 180].forEach((f, i) => {
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.connect(g); g.connect(audioCtx.destination);
            const start = now + (i * 0.15);
            osc.type = 'square';
            osc.frequency.setValueAtTime(f, start);
            osc.frequency.exponentialRampToValueAtTime(f/2, start + 0.2);
            g.gain.setValueAtTime(0.05, start);
            g.gain.exponentialRampToValueAtTime(0.01, start + 0.2);
            osc.start(start); osc.stop(start + 0.2);
        });
    } else if (type === 'win') {
        [523.25, 659.25, 783.99].forEach((f, i) => {
            playNote(f, now + (i * 0.1), 0.5);
        });
    }
}
function playNote(f, t, d) {
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.connect(g); g.connect(audioCtx.destination);
    o.frequency.setValueAtTime(f, t);
    g.gain.setValueAtTime(0.1, t);
    g.gain.linearRampToValueAtTime(0, t + d);
    o.start(t); o.stop(t + d);
}

/* =========================================
    âœ¨ BACKGROUND ANIMATION ENGINE
   ========================================= */
let activeAnimation = null;
const colors = ['#ff6b6b','#feca57','#48dbfb','#1dd1a1','#f368e0','#ff9ff3','#54a0ff','#00d2d3'];

function startBg(canvasId) {
    if (activeAnimation) cancelAnimationFrame(activeAnimation);
    const canvas = document.getElementById(canvasId);
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const shapes = Array.from({length: 25}, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 20 + 10,
        vx: (Math.random() - 0.5) * 0.5,
        vy: (Math.random() - 0.5) * 0.5,
        c: colors[Math.floor(Math.random() * colors.length)]
    }));

    function draw() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        shapes.forEach(s => {
            s.x += s.vx; s.y += s.vy;
            if(s.x < 0 || s.x > canvas.width) s.vx *= -1;
            if(s.y < 0 || s.y > canvas.height) s.vy *= -1;
            ctx.beginPath();
            ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
            ctx.fillStyle = s.c + "33"; 
            ctx.fill();
        });
        activeAnimation = requestAnimationFrame(draw);
    }
    draw();
}

/* =========================================
    ðŸŽ® GAME LOGIC
   ========================================= */
const sets = [
    {
        q: [
            {t:"1. Ano ang bahagi ng software na ginagamit para gawing makapal, pahilig, o may underline ang text?", a:"A"},
            {t:"2. Ano ang button na ginagamit para hindi mawala ang dokumento kapag biglang nawala ang kuryente?", a:"B"},
            {t:"3. Ano ang menu na ginagamit para pumili ng style, laki, at kulay ng letra?", a:"C"},
            {t:"4. Ano ang bahagi ng software na ginagamit para magdagdag ng larawan o table sa dokumento?", a:"D"},
            {t:"5. Ano ang bar sa ibaba ng screen na ginagamit para mag-scroll pataas at pababa sa dokumento?", a:"E"}
        ],
        i: [
            {l:"A", s:"mmfontmenu.png"},
            {l:"B", s:"mmsavebutton.png"},
            {l:"C", s:"mmcolorpicker.png"},
            {l:"D", s:"mminsertmenu.png"},
            {l:"E", s:"mmscrollbar.png"}
        ]
    },
    {
        q: [
            {t:"1. Ano ang bahagi ng font menu na ginagamit para gawing pahilig ang text?", a:"A"},
            {t:"2. Ano ang bahagi ng font menu na ginagamit para gawing makapal ang text?", a:"B"},
            {t:"3. Ano ang bar sa ibaba ng screen na ginagamit para mag-scroll pataas at pababa sa dokumento?", a:"C"},
            {t:"4. Ano ang menu na ginagamit para pumili ng style, laki, at kulay ng letra?", a:"D"},
            {t:"5. Ano ang button na ginagamit para hindi mawala ang dokumento kapag biglang nawala ang kuryente?", a:"E"}
        ],
        i: [
            {l:"A", s:"mmitalic.png"},
            {l:"B", s:"mmbold.png"},
            {l:"C", s:"mmscrollbar.png"},
            {l:"D", s:"mmfontmenu.png"},
            {l:"E", s:"mmsavebutton.png"}
        ]
    }
];

let currentLevel = 0;
let connections = new Map();
let selectedQ = null;

function goToPage(id) {
    playSound('pop');
    document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
    document.getElementById(id).style.display = 'flex';
    
    if (id === 'front-page') startBg('frontBg');
    if (id === 'instructions-page') startBg('instrBg');
    if (id === 'game-page') {
        startBg('gameBg');
        initGame();
    }
    if (id === 'congrats-page') startBg('winBg');
}

function initGame() {
    connections.clear();
    const qCol = document.getElementById('questions-column');
    const iCol = document.getElementById('images-column');
    qCol.innerHTML = ''; iCol.innerHTML = '';
    
    const data = sets[currentLevel];

    data.q.forEach(item => {
        const div = document.createElement('div');
        div.className = 'question';
        div.innerHTML = `<span>${item.t}</span><span class="status-icon"></span>`;
        div.onclick = () => {
            playSound('pop');
            document.querySelectorAll('.question').forEach(el => el.classList.remove('selected'));
            div.classList.add('selected');
            selectedQ = div;
            selectedQ.dataset.ans = item.a;
        };
        qCol.appendChild(div);
    });

    [...data.i].sort(() => Math.random() - 0.5).forEach(item => {
        const box = document.createElement('div');
        box.className = 'image-box';
        box.innerHTML = `<div class="image-item" data-l="${item.l}">
            <span class="letter-label">${item.l}</span>
            <img src="${item.s}" alt="tool" onerror="this.src='https://via.placeholder.com/150?text=Tool'">
        </div>`;
        box.onclick = () => {
            if (!selectedQ) return;
            playSound('pop');
            connections.set(selectedQ, box.querySelector('.image-item'));
            
            selectedQ.style.borderColor = "#cdb4db";
            selectedQ.style.background = "white";
            const icon = selectedQ.querySelector('.status-icon');
            icon.style.display = "none";

            selectedQ.classList.remove('selected');
            selectedQ = null;
            renderLines();
        };
        iCol.appendChild(box);
    });

    const canvas = document.getElementById('arrowCanvas');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}

function renderLines() {
    const canvas = document.getElementById('arrowCanvas');
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,canvas.width,canvas.height);
    
    // Solid line configuration
    ctx.setLineDash([]); // Set to empty array for solid lines
    ctx.lineWidth = 4;
    ctx.strokeStyle = "#6a4fb2";
    ctx.lineCap = "round";
    ctx.lineJoin = "round";

    connections.forEach((img, q) => {
        const r1 = q.getBoundingClientRect();
        const r2 = img.getBoundingClientRect();
        ctx.beginPath();
        ctx.moveTo(r1.right, r1.top + r1.height/2);
        ctx.lineTo(r2.left, r2.top + r2.height/2);
        ctx.stroke();
    });
}

document.getElementById('submit-btn').onclick = () => {
    if (connections.size < 5) return;
    let score = 0;
    connections.forEach((img, q) => {
        const isCorrect = q.dataset.ans === img.dataset.l;
        const icon = q.querySelector('.status-icon');
        
        if (isCorrect) score++;
        
        q.style.borderColor = isCorrect ? "#1dd1a1" : "#ff6b6b";
        q.style.background = isCorrect ? "#e6fffa" : "#fff5f5";
        
        icon.textContent = isCorrect ? "âœ…" : "âŒ";
        icon.style.display = "inline-block";
    });

    const scoreBox = document.getElementById('scoreBox');
    scoreBox.textContent = `Score: ${score} / 5`;
    scoreBox.style.display = 'block';

    if (score === 5) {
        playSound('success');
        if (currentLevel >= sets.length - 1) {
            setTimeout(() => { playSound('win'); goToPage('congrats-page'); }, 1500);
        }
    } else {
        playSound('error');
    }
};

document.getElementById('nextSet-btn').onclick = () => {
    if (currentLevel < sets.length - 1) {
        currentLevel++;
        initGame();
        document.getElementById('scoreBox').style.display = 'none';
    } else {
        goToPage('congrats-page');
    }
};

window.onload = () => {
    goToPage('front-page');
};

window.onresize = () => {
    const active = document.querySelector('.page[style*="display: flex"]');
    if (active) {
        const canvas = active.querySelector('.bg-canvas');
        if (canvas) startBg(canvas.id);
        if (active.id === 'game-page') {
            const arrowC = document.getElementById('arrowCanvas');
            arrowC.width = window.innerWidth;
            arrowC.height = window.innerHeight;
            renderLines();
        }
    }
};
</script>
</body>
</html>

